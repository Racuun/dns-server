#include <iostream>
#include <vector>
#include <cstdint>
#include <fstream>

#include "dns.hpp"


int main(int, char**){

    std::ifstream file("../query_google_a.bin", std::ios::binary);

    std::vector<uint8_t> buffer((std::istreambuf_iterator<char>(file)), {});

    // Packet::process_packet(buffer.data(), buffer.size());


    // Packet::PacketBuilder builder;
    // builder.build_header(Packet::OPCODE::QUERY, 1);
    // builder.add_question("google.com", Packet::QTYPE::A, 1);
    // Packet::DNSPacket* packet = builder.get_packet();
    // std::cout << std::hex << builder.serialize_packet(packet);

    dnslib::DNSPacket packet = dnslib::PacketBuilder(1234)
                                .withOpcode(dnslib::OPCODE::STATUS)
                                .withFlags(dnslib::PacketFlag::NONE)
                                .withRcode(dnslib::RCODE::NOERROR)
                                .addQuestion("google.com", dnslib::QTYPE::A)
                                .build();

    std::cout << packet.toString();

    std::cout << "\n\n READ PACKET: \n";

    dnslib::DNSPacket parsed = dnslib::PacketParser::parse(buffer);
    std::cout << parsed.toString();


    unsigned char rawData[] = {0xc8, 0x5e, 0x81, 0x80, 0x0, 0x1, 0x0, 0x6, 0x0, 0x0, 0x0, 0x1, 0x6, 0x67, 0x6f, 0x6f, 0x67, 0x6c, 0x65, 0x3, 0x63, 0x6f, 0x6d, 0x0, 0x0, 0x1, 0x0, 0x1, 0xc0, 0xc, 0x0, 0x1, 0x0, 0x1, 0x0, 0x0, 0x0, 0x9f, 0x0, 0x4, 0x8e, 0xfa, 0x6d, 0x66, 0xc0, 0xc, 0x0, 0x1, 0x0, 0x1, 0x0, 0x0, 0x0, 0x9f, 0x0, 0x4, 0x8e, 0xfa, 0x6d, 0x8a, 0xc0, 0xc, 0x0, 0x1, 0x0, 0x1, 0x0, 0x0, 0x0, 0x9f, 0x0, 0x4, 0x8e, 0xfa, 0x6d, 0x64, 0xc0, 0xc, 0x0, 0x1, 0x0, 0x1, 0x0, 0x0, 0x0, 0x9f, 0x0, 0x4, 0x8e, 0xfa, 0x6d, 0x8b, 0xc0, 0xc, 0x0, 0x1, 0x0, 0x1, 0x0, 0x0, 0x0, 0x9f, 0x0, 0x4, 0x8e, 0xfa, 0x6d, 0x71, 0xc0, 0xc, 0x0, 0x1, 0x0, 0x1, 0x0, 0x0, 0x0, 0x9f, 0x0, 0x4, 0x8e, 0xfa, 0x6d, 0x65, 0x0, 0x0, 0x29, 0x4, 0xd0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0};
    std::vector<uint8_t> response_buffer(rawData, rawData + sizeof(rawData));

    std::cout << "\n\n READ PACKET 2: \n";

    dnslib::DNSPacket parsed2 = dnslib::PacketParser::parse(response_buffer);
    std::cout << parsed2.toString();

    return 0;
}
